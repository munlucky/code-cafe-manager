# [Case ID] Claude CLI 통합 테스트 결과

## 문서 정보
- **Case ID**: [W-PS-01 / M-BASH-01 / M-ZSH-01 / L-BASH-01 등]
- **테스트 일자**: YYYY-MM-DD
- **테스터**: [이름 또는 "자동화"]
- **문서 버전**: 1.0

---

## 환경 정보

### OS 및 셸
- **OS**: [Windows 11 / macOS 14.x / Ubuntu 22.04 등]
- **OS 버전**: [자세한 버전]
- **셸/구동 방식**: [PowerShell / zsh / bash login]
- **셸 버전**: [PowerShell 5.1 / zsh 5.9 / bash 5.1 등]

### Claude CLI 설치 정보
- **설치 방식**: [npm / bun / pipx / manual]
- **CLI 버전**: [claude --version 출력]
- **설치 경로**: [which/where.exe claude 출력]
- **실행 권한**: [있음 / 없음]

### 인증 상태
- **로그인 상태**: [완료 / 미완료 / 필요 시 프롬프트]
- **API 키 설정**: [완료 / 미완료]

---

## 테스트 결과 요약

### 전체 결과
- **최종 결과**: [PASS / FAIL]
- **테스트 기간**: [YYYY-MM-DD HH:MM ~ HH:MM]

### 레벨별 성공률

| 레벨 | 테스트 항목 | 시도 횟수 | 성공 횟수 | 성공률 | 결과 |
|------|-----------|----------|----------|--------|------|
| **L1** | 초기화 (waitForPrompt) | [5] | [5] | [100%] | [PASS/FAIL] |
| **L2** | 출력 스트리밍 (order:output) | [5] | [5] | [100%] | [PASS/FAIL] |
| **L3** | 입력 전송 (sendInput) | [3] | [3] | [100%] | [PASS/FAIL] |
| **L4** | 실패 처리 (fail-fast + cleanup) | [2] | [2] | [100%] | [PASS/FAIL] |

---

## 상세 테스트 결과

### L1: 초기화 테스트 (S1)

#### 테스트 목표
Claude CLI 프롬프트 준비 완료 감지 (waitForPrompt 성공)

#### 테스트 절차
1. CodeCafe Desktop 앱 실행
2. 최소 주문(order) 생성
3. Order 실행 (execute)
4. 로그에서 spawn 단계 확인:
   - Shell ready 확인
   - Claude 실행 명령 전송 확인
   - waitForPrompt 성공/실패 확인

#### 기대 결과
- 10~30초 내 waitForPrompt 성공
- 실패 시 링버퍼에 원인 단서 출력

#### 실제 결과
- **상태**: [PASS / FAIL]
- **평균 초기화 시간**: [초]
- **성공 횟수**: [N/5]

#### 실패 로그 (링버퍼 요약)
```
[초기화 실패 시 startupBuffer 내용 (상위 10줄 또는 전체)]

예시:
PS C:\> claude
claude : The term 'claude' is not recognized...
```

#### 재현 가능성
- **재현 가능**: [Yes / No]
- **빈도**: [Always / 3/5 times / Intermittent]
- **원인 분석**: [원인 설명]

---

### L2: 출력 스트리밍 테스트 (S2)

#### 테스트 목표
order:output 이벤트가 UI로 실시간 스트리밍되는지 확인

#### 테스트 절차
1. 짧은 프롬프트 전송: "안녕" 또는 "한 줄만 출력해줘"
2. UI 로그창/터미널 뷰에서 출력 누적 관찰
3. 완료 이벤트/상태 변경 확인

#### 기대 결과
- order:output 이벤트가 실행 중 지속적으로 도착
- 완료 후 종료 이벤트 발생
- 출력이 최소 1회 이상 UI에 표시

#### 실제 결과
- **상태**: [PASS / FAIL]
- **평균 응답 시간**: [ms]
- **출력 누락 여부**: [있음 / 없음]

#### 문제점
- [있는 경우 설명]

---

### L3: 입력 전송 테스트 (S3)

#### 테스트 목표
실행 중 입력이 PTY에 전달되고 CLI 반응을 유발하는지 확인

#### 테스트 절차
1. 입력 대기가 필요한 프롬프트 전송:
   - "추가 질문이 있으면 물어봐"
   - 또는 "내가 답하면 계속 진행해"
2. UI 입력창(sendInput)으로 답변 전송
3. 이후 출력이 이어지는지 확인

#### 기대 결과
- 입력이 전달되고 출력이 재개/변화
- 실행 중이 아닌 orderId에 입력 시 명확한 에러 반환

#### 실제 결과
- **상태**: [PASS / FAIL]
- **입력→반응 횟수**: [N/3]
- **평균 응답 시간**: [ms]

#### 문제점
- [있는 경우 설명]

---

### L4: 실패 처리 테스트 (S4)

#### 테스트 목표
실패 시 원인 분리 및 좀비 프로세스 방지

#### 테스트 케이스

##### 케이스 1: PATH 실패 유도
- **절차**: 임시로 claude를 PATH에서 제거 또는 잘못된 경로 지정
- **기대**: fail-fast로 즉시 에러, 불필요한 대기 없음
- **실제 결과**: [PASS / FAIL]
- **실패 유형**: [PATH_ERROR / 기타]

##### 케이스 2: Spawn timeout 유도
- **절차**: waitForPrompt를 엄격하게 하여 타임아웃 유발 (개발 브랜치)
- **기대**: timeout 후 PTY kill/정리 로그 확인
- **실제 결과**: [PASS / FAIL]
- **좀비 프로세스 존재 여부**: [있음 / 없음]

#### 좀비 프로세스 확인
```bash
# Windows
tasklist | findstr claude

# macOS/Linux
ps aux | grep claude
```
- **결과**: [정상적으로 정리됨 / 좀비 프로세스 발견]

---

## 문제점 및 해결 방안

### 발견된 문제점
1. **[문제 제목]**
   - **증상**: [구체적인 증상]
   - **영향 범위**: [L1/L2/L3/L4]
   - **재현 빈도**: [Always / Intermittent]

### 해결 방안/가설
1. **[해결 방안 제목]**
   - **설명**: [해결 방안 설명]
   - **예상 효과**: [기대되는 효과]
   - **구현 여부**: [완료 / 진행 중 / 계획됨]

---

## 결론

### 통과 기준 충족 여부
- **개별 케이스 기준**:
  - [x] 초기화 성공률: 5회 중 5회 (또는 95% 이상)
  - [x] 스트리밍: 5회 중 5회 UI 출력 확인
  - [x] 입력: 3회 이상 입력→반응 확인
  - [x] 실패 처리: 원인 분리 + 프로세스 정리 확인

### 최종 판정
- **결과**: [PASS / FAIL]
- **비고**: [추가 설명]

---

## 첨부 자료

### 로그 파일
- [로그 파일 경로 또는 첨부]

### 스크린샷
- [문제 발생 시 스크린샷 첨부]

### 기타 참고 자료
- [추가 참고 자료]

---

**문서 작성일**: YYYY-MM-DD
**최종 업데이트**: YYYY-MM-DD
**작성자**: [이름]
